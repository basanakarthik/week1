Updated version with graceful interrupt handling.